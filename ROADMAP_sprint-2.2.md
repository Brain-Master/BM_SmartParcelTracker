# –ü–ª–∞–Ω —Å–ø—Ä–∏–Ω—Ç–∞ 2.2 ‚Äî Advanced Features & UX

**–ü—Ä–æ–µ–∫—Ç:** BM Smart Parcel Tracker  
**–°–ø—Ä–∏–Ω—Ç:** 2.2  
**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 3‚Äì4 –Ω–µ–¥–µ–ª–∏ (15‚Äì20 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)  
**–§–æ–∫—É—Å:** Split shipments (ParcelItem), –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–æ–≤ Dashboard, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞/–∞—Ä—Ö–∏–≤, —Ñ–æ—Ä–º—É–ª–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞  
**–°—Ç–∞—Ç—É—Å:** üöß –í —Ä–∞–±–æ—Ç–µ (—á–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω)  
**–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ø—Ä–∏–Ω—Ç:** 2.1 ‚Äî ‚úÖ COMPLETED (CRUD —Ñ–æ—Ä–º—ã, Currency, Navigation, Summary cards)  
**–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω:** [ROADMAP_sprint-2.2-DETAILED.md](./ROADMAP_sprint-2.2-DETAILED.md)

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

### –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –ø–æ—Å–ª–µ 2.1

- **Backend:** Order, Parcel, OrderItem —Å `quantity_received`; Currency (CBR); 27+ —Ç–µ—Å—Ç–æ–≤.
- **Frontend:** AppLayout, OrderForm, ParcelForm, OrderItem inline, Summary cards, MasterTable —Å expand.
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ–¥–Ω–æ–π –ø–æ—Å—ã–ª–∫–µ —á–µ—Ä–µ–∑ `quantity_received` ‚Äî –Ω–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ split –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ—Å—ã–ª–∫–∞–º.

### –¶–µ–ª–∏ —Å–ø—Ä–∏–Ω—Ç–∞ 2.2

1. **Split shipments:** –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Å—ã–ª–∫–∞—Ö (ParcelItem junction).
2. **–ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–æ–≤ Dashboard:** –ø–æ –∑–∞–∫–∞–∑–∞–º / –ø–æ –ø–æ—Å—ã–ª–∫–∞–º / –ø–æ —Ç–æ–≤–∞—Ä–∞–º / –ø–æ —Å—Ç–∞—Ç—É—Å—É.
3. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ, –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ** –∑–∞–∫–∞–∑–æ–≤ –∏ –ø–æ—Å—ã–ª–æ–∫.
4. **–§–æ—Ä–º—É–ª–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞:** —Ç–æ–≤–∞—Ä—ã + –¥–æ—Å—Ç–∞–≤–∫–∞ + –ø–æ—à–ª–∏–Ω–∞, breakdown –≤ UI.

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ —Å–ø—Ä–∏–Ω—Ç–∞

- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ—Å—ã–ª–∫–∞–º (—Ä–∞–∑–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞).
- [ ] –í Dashboard –¥–æ—Å—Ç—É–ø–Ω—ã 4 –≤–∏–¥–∞: –ó–∞–∫–∞–∑—ã, –ü–æ—Å—ã–ª–∫–∏, –¢–æ–≤–∞—Ä—ã, –°—Ç–∞—Ç—É—Å ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã 3 –≤–∏–¥–∞ (–ó–∞–∫–∞–∑—ã, –ü–æ—Å—ã–ª–∫–∏, –¢–æ–≤–∞—Ä—ã).
- [x] –†–∞–±–æ—Ç–∞—é—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º, —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º, –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ¬´–ü–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ö–∏–≤¬ª.
- [x] –í –∑–∞–∫–∞–∑–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–∞–∑–±–∏–≤–∫–∞: —Ç–æ–≤–∞—Ä—ã + –¥–æ—Å—Ç–∞–≤–∫–∞ + –ø–æ—à–ª–∏–Ω–∞ = –∏—Ç–æ–≥–æ.
- [ ] **–°—Ç–∞—Ç—É—Å—ã –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–∞:** –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä (–ñ–¥—ë—Ç –æ–ø–ª–∞—Ç—ã, –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã, –í —Å–±–æ—Ä–∫–µ, –ß–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ, –ü–æ–ª—É—á–µ–Ω–æ, –ü–æ—Ç–µ—Ä—è–Ω–æ, –ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω); –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å—ã–ª–∫–∏ (–î–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ / –ü–æ—Ç–µ—Ä—è–Ω–∞) —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è; –≤ UI —Å—Ç–∞—Ç—É—Å—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é.
- [x] –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏ (pytest), 0 –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞ (ruff, eslint).

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```mermaid
graph LR
    T1[2.2.1 Split Shipments] --> T2[2.2.2 Views]
    T3[2.2.3 Sort/Archive] --> T2
    T4[2.2.4 Cost Formula] --> T2
    T1 --> UI[ParcelForm/OrderForm UI]
    T4 --> UI
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫:**  
–ù–µ–¥–µ–ª—è 1 ‚Äî Task 2.2.1 (ParcelItem) + –Ω–∞—á–∞–ª–æ 2.2.4 (–º–æ–¥–µ–ª—å/–º–∏–≥—Ä–∞—Ü–∏–∏).  
–ù–µ–¥–µ–ª—è 2 ‚Äî Task 2.2.3 (is_archived, sort, delete/archive) + –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ 2.2.4 (UI) + Task 2.2.7 (—Å—Ç–∞—Ç—É—Å—ã –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ø–æ—Å—ã–ª–∫–∞–º–∏).  
–ù–µ–¥–µ–ª—è 3‚Äì4 ‚Äî Task 2.2.2 (–≤—Å–µ 4 view) + —Ç–µ—Å—Ç—ã –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞.

**Task 2.2.7 (—Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞/–ø–æ–∑–∏—Ü–∏–π):** –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ (–ñ–¥—ë—Ç –æ–ø–ª–∞—Ç—ã, –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã, –í —Å–±–æ—Ä–∫–µ, –ß–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ, –ü–æ–ª—É—á–µ–Ω–æ, –ü–æ—Ç–µ—Ä—è–Ω–æ, –ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω); –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å—ã–ª–∫–∏ (–î–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ ‚Üí Received/Partially_Received, –ü–æ—Ç–µ—Ä—è–Ω–∞ ‚Üí Lost). –î–µ—Ç–∞–ª–∏ ‚Äî –≤ [ROADMAP_sprint-2.2-DETAILED.md](./ROADMAP_sprint-2.2-DETAILED.md) (–∑–∞–¥–∞—á–∞ 2.2.7).

---

## –ù–µ–¥–µ–ª—è 1: Split Shipments + –æ—Å–Ω–æ–≤–∞ —Ñ–æ—Ä–º—É–ª—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏

### Task 2.2.1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Split Shipments (ParcelItem)

**–¶–µ–ª—å:** –°–≤—è–∑—å many-to-many OrderItem ‚Üî Parcel —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É ParcelItem (–æ–¥–∏–Ω —Ç–æ–≤–∞—Ä ‚Äî –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Å—ã–ª–∫–∞—Ö —Å —Ä–∞–∑–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º).

**–°—Ö–µ–º–∞ –ë–î:**

```sql
CREATE TABLE parcel_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    parcel_id UUID NOT NULL REFERENCES parcels(id) ON DELETE CASCADE,
    order_item_id UUID NOT NULL REFERENCES order_items(id) ON DELETE CASCADE,
    quantity INT NOT NULL CHECK (quantity > 0),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(parcel_id, order_item_id)
);
```

**Backend (–æ—Ü–µ–Ω–∫–∞: 2‚Äì3 –¥–Ω—è):**

| –®–∞–≥ | –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|------|----------|
| 1 | `backend/app/models/parcel_item.py` | –ù–æ–≤—ã–π –º–æ–¥–µ–ª—å ParcelItem (id, parcel_id, order_item_id, quantity, TimestampMixin). |
| 2 | `backend/app/models/parcel.py` | Relationship –∫ ParcelItem. |
| 3 | `backend/app/models/order_item.py` | Relationship –∫ ParcelItem. |
| 4 | `backend/alembic/versions/004_add_parcel_items.py` | –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã parcel_items. |
| 5 | `backend/app/schemas/parcel_item.py` | ParcelItemCreate, ParcelItemRead, ParcelItemUpdate. |
| 6 | `backend/app/services/parcel_item_service.py` | CRUD –¥–ª—è ParcelItem (create/update/delete/list by parcel). |
| 7 | `backend/app/api/parcel_items.py` | Endpoints: POST/GET/PUT/DELETE –¥–ª—è parcel_items (–∏–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –≤ parcels). |
| 8 | `backend/app/services/parcel_service.py` | –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ—Å—ã–ª–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–ø–∏—Å–æ–∫ items —Å quantity. |
| 9 | –†–µ—à–µ–Ω–∏–µ –ø–æ `quantity_received` | –í–∞—Ä–∏–∞–Ω—Ç A: –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ —Å—á–∏—Ç–∞—Ç—å –∫–∞–∫ sum(parcel_items.quantity). –í–∞—Ä–∏–∞–Ω—Ç B: —É–±—Ä–∞—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–µ–∑–¥–∞ UI. |

**Frontend (–æ—Ü–µ–Ω–∫–∞: 1‚Äì2 –¥–Ω—è):**

| –®–∞–≥ | –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|------|----------|
| 1 | `frontend/src/types/index.ts` | –¢–∏–ø—ã ParcelItem, ParcelWithItems. |
| 2 | `frontend/src/hooks/useParcelItems.ts` | createParcelItem, updateParcelItem, deleteParcelItem (–∏–ª–∏ —á–µ—Ä–µ–∑ useParcels). |
| 3 | `frontend/src/pages/ParcelForm.tsx` | –í—ã–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–∫–∞–∑–∞ + –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ —ç—Ç–æ–π –ø–æ—Å—ã–ª–∫–µ (–≤–º–µ—Å—Ç–æ/–≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ —Ç–µ–∫—É—â–µ–º—É quantity_received). |
| 4 | `frontend/src/pages/DesktopDashboard.tsx` / `MasterTable.tsx` | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ¬´–¢–æ–≤–∞—Ä X: –ø–æ—Å—ã–ª–∫–∞ 1 (2 —à—Ç), –ø–æ—Å—ã–ª–∫–∞ 2 (1 —à—Ç)¬ª. |

**DoD Task 2.2.1:**

- [x] –¢–∞–±–ª–∏—Ü–∞ `parcel_items` —Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏–µ–π 004.
- [x] API –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å order_item –∫ parcel —Å quantity.
- [x] –í ParcelForm –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ø–æ—Å—ã–ª–∫–µ (frontend).
- [x] –í Dashboard –≤–∏–¥–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –ø–æ—Å—ã–ª–∫–∞–º (frontend).
- [x] –ï—Å—Ç—å –º–∏–Ω–∏–º—É–º 2‚Äì3 pytest –Ω–∞ parcel_item (create, list, constraint).

---

### Task 2.2.4 (—á–∞—Å—Ç—å 1): –ü–æ–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –ø–æ—à–ª–∏–Ω—ã –≤ Order

**–¶–µ–ª—å:** –ó–∞–ª–æ–∂–∏—Ç—å –º–æ–¥–µ–ª—å –∏ API –¥–ª—è —Ñ–æ—Ä–º—É–ª—ã ¬´–∏—Ç–æ–≥–æ = —Ç–æ–≤–∞—Ä—ã + –¥–æ—Å—Ç–∞–≤–∫–∞ + –ø–æ—à–ª–∏–Ω–∞¬ª.

**Backend (–æ—Ü–µ–Ω–∫–∞: 1 –¥–µ–Ω—å):**

| –®–∞–≥ | –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|------|----------|
| 1 | `backend/alembic/versions/005_add_shipping_customs_costs.py` | ADD COLUMN shipping_cost, customs_cost (NUMERIC(10,2), nullable) –≤ orders. |
| 2 | `backend/app/models/order.py` | –ü–æ–ª—è shipping_cost, customs_cost; property total_items_cost (sum item price*quantity); property total_order_cost. |
| 3 | `backend/app/schemas/order.py` | OrderCreate/OrderUpdate/OrderRead ‚Äî –¥–æ–±–∞–≤–∏—Ç—å shipping_cost, customs_cost; –≤ Read ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ total_order_cost. |
| 4 | `backend/app/services/order_service.py` | –ü—Ä–∏ create/update –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å shipping_cost, customs_cost. |

**DoD (—á–∞—Å—Ç—å 1):**

- [x] –ú–∏–≥—Ä–∞—Ü–∏—è 005 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞.
- [x] Order –∏–º–µ–µ—Ç shipping_cost, customs_cost –∏ computed total (–≤ –∫–æ–¥–µ –∏–ª–∏ –≤ API response).
- [x] –¢–µ—Å—Ç—ã –Ω–∞ create/update order —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç).

---

## –ù–µ–¥–µ–ª—è 2: –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ + UI —Å—Ç–æ–∏–º–æ—Å—Ç–∏

### Task 2.2.3: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ, –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¶–µ–ª—å:** –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º, —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º, –º—è–≥–∫–æ–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ (is_archived).

**Backend (–æ—Ü–µ–Ω–∫–∞: 1 –¥–µ–Ω—å):**

| –®–∞–≥ | –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|------|----------|
| 1 | `backend/alembic/versions/012_add_is_archived_to_orders_and_parcels.py` | ADD COLUMN is_archived (006 —É–∂–µ –∑–∞–Ω—è—Ç–∞ –ø–æ–¥ deleted_at). |
| 2 | `backend/app/models/order.py`, `backend/app/models/parcel.py` | –ü–æ–ª–µ is_archived. |
| 3 | `backend/app/schemas/order.py`, `parcel.py` | –ü–æ–ª–µ is_archived –≤ Read/Update. |
| 4 | `backend/app/services/order_service.py`, `parcel_service.py` | list_orders/list_parcels –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ñ–∏–ª—å—Ç—Ä—É—é—Ç is_archived=False; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π query-–ø–∞—Ä–∞–º–µ—Ç—Ä include_archived. |
| 5 | `backend/app/api/orders.py`, `parcels.py` | Query-–ø–∞—Ä–∞–º–µ—Ç—Ä include_archived; PATCH/DELETE –¥–ª—è archive (–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint). |

**Frontend (–æ—Ü–µ–Ω–∫–∞: 1.5‚Äì2 –¥–Ω—è):**

| –®–∞–≥ | –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|------|----------|
| 1 | `frontend/src/pages/DesktopDashboard.tsx` | State: sortBy, sortDirection; –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ API –∏–ª–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ; toggle ¬´–ü–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ö–∏–≤¬ª (include_archived). |
| 2 | `frontend/src/components/MasterTable.tsx` | –ö–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∫–æ–ª–æ–Ω–∫–∏ ‚Üí —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä ‚ñ≤/‚ñº. |
| 3 | –ö–Ω–æ–ø–∫–∏ –≤ —Å—Ç—Ä–æ–∫–∞—Ö | –ò–∫–æ–Ω–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã ‚Üí –º–æ–¥–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí DELETE. –ö–Ω–æ–ø–∫–∞ ¬´–í –∞—Ä—Ö–∏–≤¬ª ‚Üí PATCH is_archived=true. |
| 4 | –§–∏–ª—å—Ç—Ä | ¬´–ü–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ö–∏–≤¬ª ‚Äî –ø–µ—Ä–µ–∑–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ —Å include_archived=true. |

**DoD Task 2.2.3:**

- [x] –í —Å–ø–∏—Å–∫–∞—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ.
- [x] –ï—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ¬´–ü–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ö–∏–≤¬ª –∏ –∫–Ω–æ–ø–∫–∞ ¬´–í –∞—Ä—Ö–∏–≤¬ª.
- [x] –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º, –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.
- [x] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º.
- [x] –¢–µ—Å—Ç—ã: list —Å include_archived, archive order/parcel.

---

### Task 2.2.4 (—á–∞—Å—Ç—å 2): UI —Ñ–æ—Ä–º—É–ª—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**Frontend (–æ—Ü–µ–Ω–∫–∞: 0.5‚Äì1 –¥–µ–Ω—å):**

| –®–∞–≥ | –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|------|----------|
| 1 | `frontend/src/pages/OrderForm.tsx` | –ü–æ–ª—è ¬´–î–æ—Å—Ç–∞–≤–∫–∞¬ª, ¬´–ü–æ—à–ª–∏–Ω–∞¬ª; –±–ª–æ–∫ ¬´–ò—Ç–æ–≥–æ: —Ç–æ–≤–∞—Ä—ã + –¥–æ—Å—Ç–∞–≤–∫–∞ + –ø–æ—à–ª–∏–Ω–∞¬ª. |
| 2 | `frontend/src/pages/DesktopDashboard.tsx` / MasterTable | –í –¥–µ—Ç–∞–ª—è—Ö –∑–∞–∫–∞–∑–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å breakdown (—Ç–æ–≤–∞—Ä—ã / –¥–æ—Å—Ç–∞–≤–∫–∞ / –ø–æ—à–ª–∏–Ω–∞ / –∏—Ç–æ–≥–æ). |

**DoD Task 2.2.4 (–ø–æ–ª–Ω–æ—Å—Ç—å—é):**

- [x] –í OrderForm –≤–≤–æ–¥ shipping_cost –∏ customs_cost, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏—Ç–æ–≥–æ.
- [x] –í Dashboard –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–∫–∞–∑–∞ (breakdown –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ).

---

## –ù–µ–¥–µ–ª—è 3‚Äì4: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∏–¥—ã Dashboard + —Ç–µ—Å—Ç—ã

### Task 2.2.2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ Dashboard Views

**–¶–µ–ª—å:** –ß–µ—Ç—ã—Ä–µ —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è: –ø–æ –∑–∞–∫–∞–∑–∞–º, –ø–æ –ø–æ—Å—ã–ª–∫–∞–º, –ø–æ —Ç–æ–≤–∞—Ä–∞–º, –ø–æ —Å—Ç–∞—Ç—É—Å—É.

**Views:**

1. **–ü–æ –∑–∞–∫–∞–∑–∞–º (By Orders)** ‚Äî —Ç–µ–∫—É—â–∏–π –≤–∏–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (order-centric, expand items).
2. **–ü–æ –ø–æ—Å—ã–ª–∫–∞–º (By Parcels)** ‚Äî parcel-centric: —Ç—Ä–µ–∫, —Å—Ç–∞—Ç—É—Å, –≤–µ—Å, –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã.
3. **–ü–æ —Ç–æ–≤–∞—Ä–∞–º (By Items)** ‚Äî –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ order_items: –Ω–∞–∑–≤–∞–Ω–∏–µ, –∑–∞–∫–∞–∑, –ø–æ—Å—ã–ª–∫–∏, —Å—Ç–∞—Ç—É—Å.
4. **–ü–æ —Å—Ç–∞—Ç—É—Å—É (By Status)** ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ delivery status (Kanban-–ø–æ–¥–æ–±–Ω–æ).

**Frontend (–æ—Ü–µ–Ω–∫–∞: 2‚Äì3 –¥–Ω—è):**

| –®–∞–≥ | –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|------|----------|
| 1 | `frontend/src/pages/DesktopDashboard.tsx` | Tab/–∫–Ω–æ–ø–∫–∏: [–ó–∞–∫–∞–∑—ã] [–ü–æ—Å—ã–ª–∫–∏] [–¢–æ–≤–∞—Ä—ã] [–°—Ç–∞—Ç—É—Å]; state currentView. |
| 2 | –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö | useMemo –¥–ª—è –∫–∞–∂–¥–æ–≥–æ view: ordersView, parcelsView, itemsView (flat), statusGroups. |
| 3 | MasterTable –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | –†–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ view; –¥–ª—è ¬´–ü–æ —Å—Ç–∞—Ç—É—Å—É¬ª ‚Äî –≥—Ä—É–ø–ø—ã (–∫–æ–ª–æ–Ω–∫–∏ –∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏). |
| 4 | API | –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏: GET /api/orders?include_items=true, GET /api/parcels (—É–∂–µ –µ—Å—Ç—å); items view —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–∑ orders/parcels –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint. |

**DoD Task 2.2.2:**

- [x] –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–æ–≤ –≤–∏–¥–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ó–∞–∫–∞–∑—ã, –ü–æ—Å—ã–ª–∫–∏, –¢–æ–≤–∞—Ä—ã).
- [x] –í–∏–¥ ¬´–ü–æ –ø–æ—Å—ã–ª–∫–∞–º¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å—ã–ª–∫–∏ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏.
- [x] –í–∏–¥ ¬´–ü–æ —Ç–æ–≤–∞—Ä–∞–º¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∑–∞–∫–∞–∑–æ–º –∏ –ø–æ—Å—ã–ª–∫–∞–º–∏.
- [ ] –í–∏–¥ ¬´–ü–æ —Å—Ç–∞—Ç—É—Å—É¬ª (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–∞–±) ‚Äî –≤ –ø–ª–∞–Ω–∞—Ö; –ø–æ–∫–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É –¥–æ—Å—Ç—É–ø–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –≤–∏–¥–æ–≤ –ü–æ—Å—ã–ª–∫–∏/–¢–æ–≤–∞—Ä—ã.

---

### –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–µ–¥–µ–ª—è: –¢–µ—Å—Ç—ã –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞

**Backend:**

- `backend/tests/test_parcel_items.py`: create, list, unique constraint, delete.
- `backend/tests/test_orders.py` / `test_parcels.py`: is_archived filter, include_archived, archive.
- `backend/tests/test_orders.py`: order —Å shipping_cost, customs_cost, –ø—Ä–æ–≤–µ—Ä–∫–∞ total.

**Frontend:**

- –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö 4 view, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, –∞—Ä—Ö–∏–≤–∞, —É–¥–∞–ª–µ–Ω–∏—è, —Ñ–æ—Ä–º—É–ª—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏.
- –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ Vitest ‚Äî –±–∞–∑–æ–≤—ã–µ —Å–Ω–∏–º–∫–∏ –∏–ª–∏ smoke-—Ç–µ—Å—Ç—ã –ø–æ –∂–µ–ª–∞–Ω–∏—é.

**CI:**

- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ CI; —Ü–µ–ª–µ–≤–æ–π –æ–±—ä—ë–º: ‚â• 35 backend-—Ç–µ—Å—Ç–æ–≤.

---

## –°–≤–æ–¥–∫–∞ –ø–æ —Ñ–∞–π–ª–∞–º

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

- `backend/app/models/parcel_item.py`
- `backend/app/schemas/parcel_item.py`
- `backend/app/services/parcel_item_service.py`
- `backend/app/api/parcel_items.py` (–∏–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –≤ parcels)
- `backend/alembic/versions/004_add_parcel_items.py`
- `backend/alembic/versions/005_add_shipping_customs_costs.py`
- `backend/alembic/versions/012_add_is_archived_to_orders_and_parcels.py`
- `frontend/src/hooks/useParcelItems.ts` (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- `backend/tests/test_parcel_items.py`

### –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã

- `backend/app/models/order.py` ‚Äî shipping_cost, customs_cost, total_order_cost; is_archived.
- `backend/app/models/parcel.py` ‚Äî is_archived; relationship parcel_items.
- `backend/app/models/order_item.py` ‚Äî relationship parcel_items.
- `backend/app/schemas/order.py`, `parcel.py` ‚Äî –Ω–æ–≤—ã–µ –ø–æ–ª—è.
- `backend/app/services/order_service.py`, `parcel_service.py` ‚Äî –ª–æ–≥–∏–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä—ã.
- `backend/app/api/orders.py`, `parcels.py` ‚Äî query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã, archive.
- `frontend/src/pages/ParcelForm.tsx` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å ParcelItem.
- `frontend/src/pages/OrderForm.tsx` ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∞/–ø–æ—à–ª–∏–Ω–∞ –∏ –∏—Ç–æ–≥–æ.
- `frontend/src/pages/DesktopDashboard.tsx` ‚Äî 4 view, sort, archive, ¬´–ü–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ö–∏–≤¬ª.
- `frontend/src/components/MasterTable.tsx` ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º, –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è/–∞—Ä—Ö–∏–≤–∞.
- `frontend/src/types/index.ts` ‚Äî ParcelItem, –∞—Ä—Ö–∏–≤—ã, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞.

---

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏–∏

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|-----------|
| –ú–∏–≥—Ä–∞—Ü–∏—è ParcelItem –ª–æ–º–∞–µ—Ç —Ç–µ–∫—É—â–∏–π ParcelForm (quantity_received) | –°—Ä–µ–¥–Ω—è—è | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å quantity_received –∫–∞–∫ derived (sum parcel_items) –∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö; –ø–æ—ç—Ç–∞–ø–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ UI. |
| –ß–µ—Ç—ã—Ä–µ view —Ä–∞–∑–¥—É–≤–∞—é—Ç DesktopDashboard | –°—Ä–µ–¥–Ω—è—è | –í—ã–Ω–µ—Å—Ç–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–Ω—Ñ–∏–≥–∏ —Ç–∞–±–ª–∏—Ü –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏/—Ñ–∞–π–ª—ã. |
| –†–∞–∑–Ω—ã–µ API –¥–ª—è sort/archive –Ω–∞ backend | –ù–∏–∑–∫–∞—è | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ; –ø—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤–∏—Ç—å sort/order_by –≤ API. |

---

## –ü–æ—Å–ª–µ —Å–ø—Ä–∏–Ω—Ç–∞ 2.2

**–ì–æ—Ç–æ–≤–æ:**

- Split shipments —á–µ—Ä–µ–∑ ParcelItem.
- –ß–µ—Ç—ã—Ä–µ –≤–∏–¥–∞ Dashboard.
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ, –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ.
- –§–æ—Ä–º—É–ª–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –∏ –ø–æ—à–ª–∏–Ω–æ–π.

**–î–∞–ª—å—à–µ (—Å–ª–µ–¥—É—é—â–∏–µ —Å–ø—Ä–∏–Ω—Ç—ã):**

- LLM Vision Import (–ø–µ—Ä–µ–Ω–µ—Å—ë–Ω —Å 2.1).
- Tracking queue (Redis/Celery), —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ protection deadline.
- PWA, –æ—Ñ–ª–∞–π–Ω, —Å–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤.
- Frontend-—Ç–µ—Å—Ç—ã (Vitest), –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry –∏ —Ç.–ø.).

---

**–î–æ–∫—É–º–µ–Ω—Ç:** –ü–ª–∞–Ω —Å–ø—Ä–∏–Ω—Ç–∞ 2.2  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 14 —Ñ–µ–≤—Ä–∞–ª—è 2026
